<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión Técnica SAP S/4HANA</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="firebase-status" id="firebaseStatus">🔄 Conectando...</div>
            <h1>🎯 Sistema de Gestión Técnica SAP S/4HANA</h1>
            <p>Plataforma integral para la gestión de proyectos de implementación</p>
        </div>

        <div class="dashboard">
            <div class="kpi-card blue" onclick="switchTab('desarrollos')">
                <div class="kpi-number" id="kpi-desarrollos">0</div>
                <div class="kpi-label">📦 Desarrollos</div>
            </div>
            <div class="kpi-card green" onclick="switchTab('desarrollos')">
                <div class="kpi-number" id="kpi-completados">0</div>
                <div class="kpi-label">✅ Completados</div>
            </div>
            <div class="kpi-card orange" onclick="switchTab('desarrollos')">
                <div class="kpi-number" id="kpi-en-desarrollo">0</div>
                <div class="kpi-label">🔨 En Desarrollo</div>
            </div>
            <div class="kpi-card purple" onclick="switchTab('fiori')">
                <div class="kpi-number" id="kpi-fiori">0</div>
                <div class="kpi-label">🚀 Apps Fiori</div>
            </div>
            <div class="kpi-card teal" onclick="switchTab('transportes')">
                <div class="kpi-number" id="kpi-transportes">0</div>
                <div class="kpi-label">🚚 Transportes</div>
            </div>
            <div class="kpi-card red" onclick="switchTab('transportes')">
                <div class="kpi-number" id="kpi-prod">0</div>
                <div class="kpi-label">🎯 En Producción</div>
            </div>
        </div>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('desarrollos')">📦 Desarrollos</button>
                <button class="tab" onclick="switchTab('fiori')">🚀 Publicaciones Fiori</button>
                <button class="tab" onclick="switchTab('transportes')">🚚 Órdenes de Transporte</button>
            </div>
        </div>

        <div id="tab-desarrollos" class="tab-content active">
            <div class="controls">
                <button class="btn btn-success" onclick="showModal('desarrollos')">➕ Nuevo Desarrollo</button>
                <button class="btn btn-export" onclick="exportToCSV('desarrollos')">📊 Exportar CSV</button>
                <select class="filter-select" id="filter-modulo" onchange="applyFilters('desarrollos')">
                    <option value="">Todos los módulos</option>
                    <option value="FI">FI - Finanzas</option>
                    <option value="CO">CO - Controlling</option>
                    <option value="SD">SD - Ventas</option>
                    <option value="MM">MM - Materiales</option>
                    <option value="PP">PP - Producción</option>
                    <option value="HR">HR - RRHH</option>
                    <option value="PM">PM - Mantenimiento</option>
                    <option value="QM">QM - Calidad</option>
                    <option value="WM">WM - Almacén</option>
                    <option value="BASIS">BASIS</option>
                </select>
                <select class="filter-select" id="filter-estado-dev" onchange="applyFilters('desarrollos')">
                    <option value="">Todos los estados</option>
                    <option value="desarrollo">En Desarrollo</option>
                    <option value="pruebas">En Pruebas</option>
                    <option value="completado">Completado</option>
                    <option value="pendiente">Pendiente</option>
                </select>
                <input type="text" class="search-box" id="search-desarrollos" placeholder="🔍 Buscar..." oninput="applyFilters('desarrollos')">
            </div>
            <div class="table-container">
                <div class="loading" id="loading-desarrollos"><div class="spinner"></div>Cargando...</div>
                <table id="table-desarrollos" style="display:none;">
                    <thead><tr><th>Nombre</th><th>Tipo</th><th>Módulo</th><th>Desarrollador</th><th>Estado</th><th>Complejidad</th><th>OT</th><th>Inicio</th><th>Fin</th><th>Descripción</th><th>Acciones</th></tr></thead>
                    <tbody id="tbody-desarrollos"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-fiori" class="tab-content">
            <div class="controls">
                <button class="btn btn-success" onclick="showModal('fiori')">➕ Nueva Publicación</button>
                <button class="btn btn-export" onclick="exportToCSV('fiori')">📊 Exportar CSV</button>
                <select class="filter-select" id="filter-ambiente-fiori" onchange="applyFilters('fiori')">
                    <option value="">Todos los ambientes</option>
                    <option value="DES">DES</option>
                    <option value="QAS">QAS</option>
                    <option value="PRD">PRD</option>
                </select>
                <select class="filter-select" id="filter-estado-fiori" onchange="applyFilters('fiori')">
                    <option value="">Todos los estados</option>
                    <option value="pendiente">Pendiente</option>
                    <option value="publicado">Publicado</option>
                    <option value="error">Error</option>
                </select>
                <input type="text" class="search-box" id="search-fiori" placeholder="🔍 Buscar..." oninput="applyFilters('fiori')">
            </div>
            <div class="table-container">
                <div class="loading" id="loading-fiori"><div class="spinner"></div>Cargando...</div>
                <table id="table-fiori" style="display:none;">
                    <thead><tr><th>Nombre</th><th>ID Semántico</th><th>Catálogo</th><th>Grupo</th><th>Roles</th><th>URL</th><th>Estado</th><th>Ambiente</th><th>Fecha</th><th>Responsable</th><th>Acciones</th></tr></thead>
                    <tbody id="tbody-fiori"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-transportes" class="tab-content">
            <div class="controls">
                <button class="btn btn-success" onclick="showModal('transportes')">➕ Nuevo Transporte</button>
                <button class="btn btn-export" onclick="exportToCSV('transportes')">📊 Exportar CSV</button>
                <select class="filter-select" id="filter-estado-ot" onchange="applyFilters('transportes')">
                    <option value="">Todos los estados</option>
                    <option value="DES">DES</option>
                    <option value="QAS">QAS</option>
                    <option value="PRD">PRD</option>
                    <option value="error">Error</option>
                    <option value="pendiente">Pendiente</option>
                </select>
                <select class="filter-select" id="filter-prioridad" onchange="applyFilters('transportes')">
                    <option value="">Todas las prioridades</option>
                    <option value="alta">Alta</option>
                    <option value="media">Media</option>
                    <option value="baja">Baja</option>
                </select>
                <input type="text" class="search-box" id="search-transportes" placeholder="🔍 Buscar..." oninput="applyFilters('transportes')">
            </div>
            <div class="table-container">
                <div class="loading" id="loading-transportes"><div class="spinner"></div>Cargando...</div>
                <table id="table-transportes" style="display:none;">
                    <thead><tr><th>Orden</th><th>Tipo</th><th>Descripción</th><th>Desarrollador</th><th>Creación</th><th>DES</th><th>QAS</th><th>PRD</th><th>Estado</th><th>Prioridad</th><th>Objetos</th><th>Acciones</th></tr></thead>
                    <tbody id="tbody-transportes"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modal-desarrollos" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('desarrollos')">&times;</span>
            <h2 id="modal-title-desarrollos">Nuevo Desarrollo</h2>
            <form id="form-desarrollos">
                <div class="form-row">
                    <div class="form-group"><label>Nombre *</label><input type="text" id="dev-nombre" required></div>
                    <div class="form-group"><label>Tipo *</label><select id="dev-tipo" required><option value="">Seleccionar</option><option value="Programa ABAP">Programa ABAP</option><option value="Clase">Clase</option><option value="Function Module">Function Module</option><option value="Smartform">Smartform</option><option value="Adobe Form">Adobe Form</option><option value="CDS View">CDS View</option><option value="Fiori App">Fiori App</option><option value="Enhancement">Enhancement</option><option value="BADI">BADI</option><option value="Tabla Z">Tabla Z</option></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Módulo *</label><select id="dev-modulo" required><option value="">Seleccionar</option><option value="FI">FI</option><option value="CO">CO</option><option value="SD">SD</option><option value="MM">MM</option><option value="PP">PP</option><option value="HR">HR</option><option value="PM">PM</option><option value="QM">QM</option><option value="WM">WM</option><option value="BASIS">BASIS</option></select></div>
                    <div class="form-group"><label>Desarrollador *</label><input type="text" id="dev-desarrollador" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Estado *</label><select id="dev-estado" required><option value="">Seleccionar</option><option value="pendiente">Pendiente</option><option value="desarrollo">En Desarrollo</option><option value="pruebas">En Pruebas</option><option value="completado">Completado</option></select></div>
                    <div class="form-group"><label>Complejidad *</label><select id="dev-complejidad" required><option value="">Seleccionar</option><option value="baja">Baja</option><option value="media">Media</option><option value="alta">Alta</option></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>OT Asociada</label><input type="text" id="dev-ot"></div>
                    <div class="form-group"><label>Fecha Inicio *</label><input type="date" id="dev-fecha-inicio" required></div>
                </div>
                <div class="form-group"><label>Fecha Fin</label><input type="date" id="dev-fecha-fin"></div>
                <div class="form-group"><label>Descripción *</label><textarea id="dev-descripcion" required></textarea></div>
                <div class="form-group"><label>Observaciones</label><textarea id="dev-observaciones"></textarea></div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">💾 Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('desarrollos')">❌ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-fiori" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('fiori')">&times;</span>
            <h2 id="modal-title-fiori">Nueva Publicación Fiori</h2>
            <form id="form-fiori">
                <div class="form-row">
                    <div class="form-group"><label>Nombre *</label><input type="text" id="fiori-nombre" required></div>
                    <div class="form-group"><label>ID Semántico *</label><input type="text" id="fiori-id" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Catálogo *</label><input type="text" id="fiori-catalogo" required></div>
                    <div class="form-group"><label>Grupo *</label><input type="text" id="fiori-grupo" required></div>
                </div>
                <div class="form-group"><label>Roles *</label><input type="text" id="fiori-roles" required></div>
                <div class="form-group"><label>URL *</label><input type="url" id="fiori-url" required></div>
                <div class="form-row">
                    <div class="form-group"><label>Estado *</label><select id="fiori-estado" required><option value="">Seleccionar</option><option value="pendiente">Pendiente</option><option value="publicado">Publicado</option><option value="error">Error</option></select></div>
                    <div class="form-group"><label>Ambiente *</label><select id="fiori-ambiente" required><option value="">Seleccionar</option><option value="DES">DES</option><option value="QAS">QAS</option><option value="PRD">PRD</option></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Fecha</label><input type="datetime-local" id="fiori-fecha"></div>
                    <div class="form-group"><label>Responsable *</label><input type="text" id="fiori-responsable" required></div>
                </div>
                <div class="form-group"><label>Observaciones</label><textarea id="fiori-observaciones"></textarea></div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">💾 Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('fiori')">❌ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-transportes" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('transportes')">&times;</span>
            <h2 id="modal-title-transportes">Nueva Orden de Transporte</h2>
            <form id="form-transportes">
                <div class="form-row">
                    <div class="form-group"><label>Número *</label><input type="text" id="ot-numero" required></div>
                    <div class="form-group"><label>Tipo *</label><select id="ot-tipo" required><option value="">Seleccionar</option><option value="Desarrollo">Desarrollo</option><option value="Corrección">Corrección</option><option value="Customizing">Customizing</option><option value="Master Data">Master Data</option><option value="Autorización">Autorización</option></select></div>
                </div>
                <div class="form-group"><label>Descripción *</label><textarea id="ot-descripcion" required></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label>Desarrollador *</label><input type="text" id="ot-desarrollador" required></div>
                    <div class="form-group"><label>Fecha Creación *</label><input type="date" id="ot-fecha-creacion" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Estado *</label><select id="ot-estado" required><option value="">Seleccionar</option><option value="pendiente">Pendiente</option><option value="DES">DES</option><option value="QAS">QAS</option><option value="PRD">PRD</option><option value="error">Error</option></select></div>
                    <div class="form-group"><label>Prioridad *</label><select id="ot-prioridad" required><option value="">Seleccionar</option><option value="alta">Alta</option><option value="media">Media</option><option value="baja">Baja</option></select></div>
                </div>
                <div class="form-group"><label>Ambientes:</label><div class="checkbox-group"><label><input type="checkbox" id="ot-passed-des"> DES</label><label><input type="checkbox" id="ot-passed-qas"> QAS</label><label><input type="checkbox" id="ot-passed-prd"> PRD</label></div></div>
                <div class="form-group"><label>Objetos</label><textarea id="ot-objetos"></textarea></div>
                <div class="form-group"><label>Fecha Transporte</label><input type="datetime-local" id="ot-fecha-transporte"></div>
                <div class="form-group"><label>Observaciones</label><textarea id="ot-observaciones"></textarea></div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">💾 Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('transportes')">❌ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="app.js"></script>
</body>
</html>